---
title: "2022 Thanksgiving Pounce"
date: 2022-11-27T20:54:00-08:00
draft: false
toc: false
tags: 
  - pounce
  - cards
data:
  sessions: 
    - session: "2022-11-18_2"
      ruleset:
        pile: 13
        bonus: 5
      hands:
        - ts: "2022-11-18T21:38:00-0700"
          players: 
            - name: "nancy"
              score: 12
              win: true
            - name: "brent"
              score: -10
            - name: "sadie"
              score: -22
            - name: "brenty"
              score: -22
            - name: "kate"
              score: -1
            - name: "tom"
              score: -23
            - name: "gavin"
              score: -12
        - ts: "2022-11-18T21:43:00-0700"
          players: 
            - name: "nancy"
              score: 9
              win: true
            - name: "brent"
              score: -17
            - name: "sadie"
              score: -9
            - name: "brenty"
              score: -7
            - name: "kate"
              score: -5
            - name: "tom"
              score: -3
            - name: "gavin"
              score: -8
        - ts: "2022-11-18T21:48:00-0700"
          players: 
            - name: "nancy"
              score: 15
              win: true
            - name: "brent"
              score: -1
            - name: "sadie"
              score: -15
            - name: "brenty"
              score: -2
            - name: "kate"
              score: -9
            - name: "tom"
              score: -5
            - name: "gavin"
              score: -2
        - ts: "2022-11-18T21:54:00-0700"
          players: 
            - name: "nancy"
              score: 0
            - name: "brent"
              score: -8
            - name: "sadie"
              score: -8
            - name: "brenty"
              score: 2
            - name: "kate"
              score: 11
              win: true
            - name: "tom"
              score: -15
            - name: "gavin"
              score: -7
            - name: "neela"
              score: -8
        - ts: "2022-11-18T21:59:00-0700"
          players: 
            - name: "nancy"
              score: -11
            - name: "brent"
              score: 9
            - name: "sadie"
              score: -17
            - name: "brenty"
              score: -9
            - name: "kate"
              score: 15
              win: true
            - name: "tom"
              score: 4
            - name: "gavin"
              score: 10
            - name: "neela"
              score: 11
        - ts: "2022-11-18T22:04:00-0700"
          players: 
            - name: "nancy"
              score: -10
            - name: "brent"
              score: -7
            - name: "sadie"
              score: -20
            - name: "brenty"
              score: -17
            - name: "kate"
              score: 11
              win: true
            - name: "tom"
              score: -1
            - name: "gavin"
              score: -12
            - name: "neela"
              score: -5
        - ts: "2022-11-18T22:10:00-0700"
          players: 
            - name: "nancy"
              score: 17
              win: true
            - name: "brent"
              score: 0
            - name: "kate"
              score: -3
            - name: "tom"
              score: -5
            - name: "gavin"
              score: -12
            - name: "neela"
              score: 2
        - ts: "2022-11-18T22:17:00-0700"
          players: 
            - name: "nancy"
              score: 8
            - name: "kate"
              score: 5
            - name: "tom"
              score: -2
            - name: "gavin"
              score: 6
            - name: "neela"
              score: 21
              win: true
        - ts: "2022-11-18T22:23:00-0700"
          players: 
            - name: "nancy"
              score: 16
              win: true
            - name: "kate"
              score: 4
            - name: "tom"
              score: 7
            - name: "gavin"
              score: -4
            - name: "neela"
              score: 15
        - ts: "2022-11-18T22:28:00-0700"
          players: 
            - name: "nancy"
              score: 9
              win: true
            - name: "kate"
              score: -10
            - name: "tom"
              score: -4
            - name: "gavin"
              score: -9
            - name: "neela"
              score: 5
        - ts: "2022-11-18T22:34:00-0700"
          players: 
            - name: "nancy"
              score: 22
              win: true
            - name: "kate"
              score: -9
            - name: "tom"
              score: 12
            - name: "gavin"
              score: 9
            - name: "neela"
              score: -4
        - ts: "2022-11-18T22:40:00-0700"
          players: 
            - name: "nancy"
              score: -18
            - name: "britta"
              score: -3
            - name: "kate"
              score: -22
            - name: "tom"
              score: -15
            - name: "gavin"
              score: -3
            - name: "neela"
              score: 15
              win: true
        - ts: "2022-11-18T22:47:00-0700"
          players: 
            - name: "nancy"
              score: 5
            - name: "britta"
              score: 1
            - name: "kate"
              score: 0
            - name: "tom"
              score: 2
            - name: "gavin"
              score: -7
            - name: "neela"
              score: 23
              win: true
        - ts: "2022-11-18T22:52:00-0700"
          players: 
            - name: "nancy"
              score: -11
            - name: "britta"
              score: -1
            - name: "kate"
              score: -5
            - name: "tom"
              score: -6
            - name: "gavin"
              score: 11
              win: true
            - name: "neela"
              score: 0
    - session: "2022-11-18_1"
      ruleset:
        pile: 13
        bonus: 5
      hands:
        - ts: "2022-11-18T16:09:00-0700"
          players: 
            - name: "nancy"
              score: 22
              win: true
            - name: "gavin"
              score: 4
            - name: "brent"
              score: 2
            - name: "sadie"
              score: 0
            - name: "tom"
              score: -1
            - name: "nino"
              score: -15
            - name: "kate"
              score: -12
        - ts: "2022-11-18T16:20:00-0700"
          players: 
            - name: "nancy"
              score: 11
            - name: "gavin"
              score: 20
              win: true
            - name: "brent"
              score: 21
            - name: "sadie"
              score: 12
            - name: "tom"
              score: 9
            - name: "kate"
              score: 11
            - name: "alissa"
              score: 1
        - ts: "2022-11-18T16:26:00-0700"
          players: 
            - name: "nancy"
              score: -1
            - name: "gavin"
              score: -9
            - name: "brent"
              score: 1
            - name: "sadie"
              score: -1
            - name: "neela"
              score: 15
            - name: "kate"
              score: -9
            - name: "alissa"
              score: 14
              win: true
        - ts: "2022-11-18T16:31:00-0700"
          players: 
            - name: "nancy"
              score: -24
            - name: "gavin"
              score: -20
            - name: "brent"
              score: 3
            - name: "sadie"
              score: -14
            - name: "neela"
              score: 7
              win: true
            - name: "kate"
              score: -4
            - name: "alissa"
              score: -15
        - ts: "2022-11-18T16:35:00-0700"
          players: 
            - name: "nancy"
              score: 13
            - name: "gavin"
              score: -12
            - name: "brent"
              score: 0
            - name: "sadie"
              score: -13
            - name: "neela"
              score: 7
            - name: "kate"
              score: -7
            - name: "alissa"
              score: 18
              win: true
---

{{< pounce.inline >}}
{{ $sessions := .Page.Params.data.sessions }}
<p>Sessions: {{ len $sessions }}</p>

<table>
  <tr>
    <th>#</th>
    <th>Start</th>
    <th>End</th>
    <th>Hands</th>
    <th>Players</th>
    <th>Player-Hands</th>
    <th>Rules</th>
  </tr>
  
  {{ range $i, $session := sort $sessions "session" }}
    {{ $distinctPlayers := dict }}
    {{ $handPlayerCount := 0 }}
    {{ $startTs := time "2199-01-01T16:35:00-0700" }}
    {{ $endTs := time "1899-01-01T16:35:00-0700" }}
    
    {{ range $hand := $session.hands }}
      {{ $handPlayerCount = add $handPlayerCount (len $hand.players) }}
      {{ $handTs := time $hand.ts }}
      {{ if lt $handTs $startTs }}
        {{ $startTs = $handTs }}
      {{ end }}
      {{ if gt $handTs $endTs }}
        {{ $endTs = $handTs }}
      {{ end }}

      {{ range $handPlayer := $hand.players }}
        {{ $distinctPlayers = merge $distinctPlayers (dict $handPlayer.name true) }}
      {{ end }}
    {{ end }}

    <tr>
      <td>{{ add $i 1 }}</td>
      <td>{{ $startTs | time.Format "01/02 15:04" }}</td>
      <td>{{ $endTs | time.Format "01/02 15:04"  }}</td>
      <td>{{ len $session.hands }}</td>
      <td>{{ len $distinctPlayers }}</td>
      <td>{{ $handPlayerCount }}</td>
      <td>{{ $session.ruleset.pile }}+{{ $session.ruleset.bonus }}</td>
    </tr>
  {{ end }}

</table>

{{ $allHands := slice }}
{{ range $session := $sessions }}
  {{ range $hand := $session.hands }}
    {{ $hand = merge $hand (dict "ruleset" $session.ruleset) }}
    {{ $allHands = $allHands | append $hand }} 
  {{ end }}
{{ end }}

<p>Hands: {{ len $allHands }}</p>

{{ $perPlayer := dict "handCount" 0 "winCount" 0 "scoreSum" 0 }}
{{ $scoreboardByPlayer := dict }}

{{ range $hand := $allHands }}
  {{ $ruleset := $hand.ruleset }}
  {{ range $handPlayer := $hand.players }}
    {{ if not (isset $scoreboardByPlayer $handPlayer.name) }}
      {{ $scoreboardByPlayer = merge $scoreboardByPlayer (dict $handPlayer.name $perPlayer)}}
    {{ end }}

    {{ $before := index $scoreboardByPlayer $handPlayer.name }}
    {{ $handPlayerScore := add $handPlayer.score (cond ($handPlayer.win | default false) $ruleset.bonus 0) }}

    {{ $after := merge $before (dict "handCount" (add (index $before "handCount") 1) "winCount" (add (index $before "winCount") (cond ($handPlayer.win | default false) 1 0)) "scoreSum" (add (index $before "scoreSum") $handPlayerScore) ) }}
    {{ $scoreboardByPlayer = merge $scoreboardByPlayer (dict $handPlayer.name $after) }}
  {{ end }}
{{ end }}

<table>
  <tr>
    <th>Rank</th>
    <th>Name</th>
    <th>Score Avg ↓</th>
  </tr>

  {{ $sortable := slice }}
  {{ range $name, $stats := $scoreboardByPlayer }}
    {{ $scoreAvg := div $stats.scoreSum (float $stats.handCount) }}
    {{ $winAvg := div $stats.winCount (float $stats.handCount) }}
    {{ $row := merge $stats (dict "name" $name "scoreAvg" $scoreAvg "winAvg" $winAvg) }}
    {{ $sortable = append $sortable (slice $row)}}
  {{ end }}

  {{ range $i, $row := sort $sortable "scoreAvg" "desc" }}
    <tr>
      <td>{{ add $i 1 }}</td>
      <td>{{ .name | title }}</td>
      <td>
        {{ lang.NumFmt 3 .scoreAvg }} ({{ .scoreSum }} / {{ .handCount }})
      </td>
    </tr>
  {{ end }}
</table>

{{< /pounce.inline >}}
